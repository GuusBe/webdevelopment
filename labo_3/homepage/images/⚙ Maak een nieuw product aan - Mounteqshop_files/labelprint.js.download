$(document).ready(function(){
    // init and show modal when clicking print label button
    $('#js-button-labelprint').on('click',function() {
        if(typeof $modal === 'undefined') {
            var modalLabelPrint = $('#modalLabelPrint');
            $modal = new Garnish.Modal(modalLabelPrint, {
                draggable: true,
                onShow: () => {

                    // print label
                    $('.btn.submit', modalLabelPrint).on({
                        click: () => {
                            printLabel();
                        },
                    });

                    // close modal
                    $('.btn.cancel', modalLabelPrint).on({
                        click: () => {
                            modalLabelPrint.data('modal').hide();
                        },
                    });
                },
                onHide: () => {
                    // hide errors
                    removeErrors();
                },
            });
        } else {
            $modal.show();
        }
    });
});


function printLabel()
{
    if(dymo.label.framework.init) {
        dymo.label.framework.init(createPrint);
    }

    function createPrint(){

        let selectedVariantId = parseInt($('#js-printVariantId').val());
        let numberOfCopies = parseInt($('#js-numberOfLabels').val());

        if(isNaN(selectedVariantId) || !selectedVariantId || !(selectedVariantId in jsVariants)) {
            alert(jsErrorVariantNotFound);
            return false;
        }

        let variantData = jsVariants[selectedVariantId];
        let eanCode = variantData.ean.substring(0,13);
        let price = variantData.price;
        let productTitle = jsProductTitle;
        let variantTitle = variantData.label;

        // if you want to create a xml for a different label size download the dymo label software from
        // https://www.dymo.com/support?cfid=dymo-compatibility-chart
        // create a new label using the editor (select correct size) and save (do a print test)
        // the .dymo save file is a xml file, replace the labelXml content with xml file content, adjust the variable values

        var labelXml = '<?xml version="1.0" encoding="utf-8"?>\n' +
            '<DesktopLabel Version="1">\n' +
            '  <DYMOLabel Version="3">\n' +
            '    <Description>DYMO Label</Description>\n' +
            '    <Orientation>Landscape</Orientation>\n' +
            '    <LabelName>ReturnAddressS0722550</LabelName>\n' +
            '    <InitialLength>0</InitialLength>\n' +
            '    <BorderStyle>SolidLine</BorderStyle>\n' +
            '    <DYMORect>\n' +
            '      <DYMOPoint>\n' +
            '        <X>0.2266667</X>\n' +
            '        <Y>0.05666666</Y>\n' +
            '      </DYMOPoint>\n' +
            '      <Size>\n' +
            '        <Width>1.713333</Width>\n' +
            '        <Height>0.6533333</Height>\n' +
            '      </Size>\n' +
            '    </DYMORect>\n' +
            '    <BorderColor>\n' +
            '      <SolidColorBrush>\n' +
            '        <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '      </SolidColorBrush>\n' +
            '    </BorderColor>\n' +
            '    <BorderThickness>1</BorderThickness>\n' +
            '    <Show_Border>False</Show_Border>\n' +
            '    <DynamicLayoutManager>\n' +
            '      <RotationBehavior>ClearObjects</RotationBehavior>\n' +
            '      <LabelObjects>\n' +
            '        <TextObject>\n' +
            '          <Name>TextObject2</Name>\n' +
            '          <Brushes>\n' +
            '            <BackgroundBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="0" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BackgroundBrush>\n' +
            '            <BorderBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BorderBrush>\n' +
            '            <StrokeBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </StrokeBrush>\n' +
            '            <FillBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="0" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </FillBrush>\n' +
            '          </Brushes>\n' +
            '          <Rotation>Rotation0</Rotation>\n' +
            '          <OutlineThickness>1</OutlineThickness>\n' +
            '          <IsOutlined>False</IsOutlined>\n' +
            '          <BorderStyle>SolidLine</BorderStyle>\n' +
            '          <Margin>\n' +
            '            <DYMOThickness Left="0" Top="0" Right="0" Bottom="0" />\n' +
            '          </Margin>\n' +
            '          <HorizontalAlignment>Left</HorizontalAlignment>\n' +
            '          <VerticalAlignment>Middle</VerticalAlignment>\n' +
            '          <FitMode>None</FitMode>\n' +
            '          <IsVertical>False</IsVertical>\n' +
            '          <FormattedText>\n' +
            '            <FitMode>None</FitMode>\n' +
            '            <HorizontalAlignment>Left</HorizontalAlignment>\n' +
            '            <VerticalAlignment>Middle</VerticalAlignment>\n' +
            '            <IsVertical>False</IsVertical>\n' +
            '            <LineTextSpan>\n' +
            '              <TextSpan>\n' +
            '                <Text>'+ price +'</Text>\n' +
            '                <FontInfo>\n' +
            '                  <FontName>Segoe UI</FontName>\n' +
            '                  <FontSize>8</FontSize>\n' +
            '                  <IsBold>False</IsBold>\n' +
            '                  <IsItalic>False</IsItalic>\n' +
            '                  <IsUnderline>False</IsUnderline>\n' +
            '                  <FontBrush>\n' +
            '                    <SolidColorBrush>\n' +
            '                      <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '                    </SolidColorBrush>\n' +
            '                  </FontBrush>\n' +
            '                </FontInfo>\n' +
            '              </TextSpan>\n' +
            '            </LineTextSpan>\n' +
            '          </FormattedText>\n' +
            '          <ObjectLayout>\n' +
            '            <DYMOPoint>\n' +
            '              <X>0.2366667</X>\n' +
            '              <Y>0.4479166</Y>\n' +
            '            </DYMOPoint>\n' +
            '            <Size>\n' +
            '              <Width>0.5125038</Width>\n' +
            '              <Height>0.2620837</Height>\n' +
            '            </Size>\n' +
            '          </ObjectLayout>\n' +
            '        </TextObject>\n' +
            '        <BarcodeObject>\n' +
            '          <Name>BarcodeObject0</Name>\n' +
            '          <Brushes>\n' +
            '            <BackgroundBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="1" G="1" B="1"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BackgroundBrush>\n' +
            '            <BorderBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BorderBrush>\n' +
            '            <StrokeBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </StrokeBrush>\n' +
            '            <FillBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </FillBrush>\n' +
            '          </Brushes>\n' +
            '          <Rotation>Rotation0</Rotation>\n' +
            '          <OutlineThickness>1</OutlineThickness>\n' +
            '          <IsOutlined>False</IsOutlined>\n' +
            '          <BorderStyle>SolidLine</BorderStyle>\n' +
            '          <Margin>\n' +
            '            <DYMOThickness Left="0" Top="0" Right="0" Bottom="0" />\n' +
            '          </Margin>\n' +
            '          <BarcodeFormat>Code39</BarcodeFormat>\n' +
            '          <Data>\n' +
            '            <MultiDataString>\n' +
            '              <DataString></DataString>\n' +
            '              <DataString>'+ eanCode +'</DataString>\n' +
            '            </MultiDataString>\n' +
            '          </Data>\n' +
            '          <HorizontalAlignment>Center</HorizontalAlignment>\n' +
            '          <VerticalAlignment>Middle</VerticalAlignment>\n' +
            '          <Size>SmallMedium</Size>\n' +
            '          <TextPosition>Bottom</TextPosition>\n' +
            '          <FontInfo>\n' +
            '            <FontName>Arial</FontName>\n' +
            '            <FontSize>8</FontSize>\n' +
            '            <IsBold>False</IsBold>\n' +
            '            <IsItalic>False</IsItalic>\n' +
            '            <IsUnderline>False</IsUnderline>\n' +
            '            <FontBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </FontBrush>\n' +
            '          </FontInfo>\n' +
            '          <ObjectLayout>\n' +
            '            <DYMOPoint>\n' +
            '              <X>0.2266667</X>\n' +
            '              <Y>0.05666673</Y>\n' +
            '            </DYMOPoint>\n' +
            '            <Size>\n' +
            '              <Width>1.618339</Width>\n' +
            '              <Height>0.2745839</Height>\n' +
            '            </Size>\n' +
            '          </ObjectLayout>\n' +
            '        </BarcodeObject>\n' +
            '        <TextObject>\n' +
            '          <Name>TextObject0</Name>\n' +
            '          <Brushes>\n' +
            '            <BackgroundBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="0" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BackgroundBrush>\n' +
            '            <BorderBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BorderBrush>\n' +
            '            <StrokeBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </StrokeBrush>\n' +
            '            <FillBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="0" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </FillBrush>\n' +
            '          </Brushes>\n' +
            '          <Rotation>Rotation0</Rotation>\n' +
            '          <OutlineThickness>1</OutlineThickness>\n' +
            '          <IsOutlined>False</IsOutlined>\n' +
            '          <BorderStyle>SolidLine</BorderStyle>\n' +
            '          <Margin>\n' +
            '            <DYMOThickness Left="0" Top="0" Right="0" Bottom="0" />\n' +
            '          </Margin>\n' +
            '          <HorizontalAlignment>Left</HorizontalAlignment>\n' +
            '          <VerticalAlignment>Middle</VerticalAlignment>\n' +
            '          <FitMode>None</FitMode>\n' +
            '          <IsVertical>False</IsVertical>\n' +
            '          <FormattedText>\n' +
            '            <FitMode>None</FitMode>\n' +
            '            <HorizontalAlignment>Left</HorizontalAlignment>\n' +
            '            <VerticalAlignment>Middle</VerticalAlignment>\n' +
            '            <IsVertical>False</IsVertical>\n' +
            '            <LineTextSpan>\n' +
            '              <TextSpan>\n' +
            '                <Text>'+ productTitle+'</Text>\n' +
            '                <FontInfo>\n' +
            '                  <FontName>Arial</FontName>\n' +
            '                  <FontSize>8</FontSize>\n' +
            '                  <IsBold>False</IsBold>\n' +
            '                  <IsItalic>False</IsItalic>\n' +
            '                  <IsUnderline>False</IsUnderline>\n' +
            '                  <FontBrush>\n' +
            '                    <SolidColorBrush>\n' +
            '                      <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '                    </SolidColorBrush>\n' +
            '                  </FontBrush>\n' +
            '                </FontInfo>\n' +
            '              </TextSpan>\n' +
            '            </LineTextSpan>\n' +
            '          </FormattedText>\n' +
            '          <ObjectLayout>\n' +
            '            <DYMOPoint>\n' +
            '              <X>0.2266667</X>\n' +
            '              <Y>0.261667</Y>\n' +
            '            </DYMOPoint>\n' +
            '            <Size>\n' +
            '              <Width>1.693333</Width>\n' +
            '              <Height>0.3121746</Height>\n' +
            '            </Size>\n' +
            '          </ObjectLayout>\n' +
            '        </TextObject>\n' +
            '        <TextObject>\n' +
            '          <Name>TextObject03</Name>\n' +
            '          <Brushes>\n' +
            '            <BackgroundBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="0" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BackgroundBrush>\n' +
            '            <BorderBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </BorderBrush>\n' +
            '            <StrokeBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </StrokeBrush>\n' +
            '            <FillBrush>\n' +
            '              <SolidColorBrush>\n' +
            '                <Color A="0" R="0" G="0" B="0"></Color>\n' +
            '              </SolidColorBrush>\n' +
            '            </FillBrush>\n' +
            '          </Brushes>\n' +
            '          <Rotation>Rotation0</Rotation>\n' +
            '          <OutlineThickness>1</OutlineThickness>\n' +
            '          <IsOutlined>False</IsOutlined>\n' +
            '          <BorderStyle>SolidLine</BorderStyle>\n' +
            '          <Margin>\n' +
            '            <DYMOThickness Left="0" Top="0" Right="0" Bottom="0" />\n' +
            '          </Margin>\n' +
            '          <HorizontalAlignment>Left</HorizontalAlignment>\n' +
            '          <VerticalAlignment>Middle</VerticalAlignment>\n' +
            '          <FitMode>None</FitMode>\n' +
            '          <IsVertical>False</IsVertical>\n' +
            '          <FormattedText>\n' +
            '            <FitMode>None</FitMode>\n' +
            '            <HorizontalAlignment>Left</HorizontalAlignment>\n' +
            '            <VerticalAlignment>Middle</VerticalAlignment>\n' +
            '            <IsVertical>False</IsVertical>\n' +
            '            <LineTextSpan>\n' +
            '              <TextSpan>\n' +
            '                <Text>'+ variantTitle +'</Text>\n' +
            '                <FontInfo>\n' +
            '                  <FontName>Arial</FontName>\n' +
            '                  <FontSize>8</FontSize>\n' +
            '                  <IsBold>False</IsBold>\n' +
            '                  <IsItalic>False</IsItalic>\n' +
            '                  <IsUnderline>False</IsUnderline>\n' +
            '                  <FontBrush>\n' +
            '                    <SolidColorBrush>\n' +
            '                      <Color A="1" R="0" G="0" B="0"></Color>\n' +
            '                    </SolidColorBrush>\n' +
            '                  </FontBrush>\n' +
            '                </FontInfo>\n' +
            '              </TextSpan>\n' +
            '            </LineTextSpan>\n' +
            '          </FormattedText>\n' +
            '          <ObjectLayout>\n' +
            '            <DYMOPoint>\n' +
            '              <X>0.7491705</X>\n' +
            '              <Y>0.4770509</Y>\n' +
            '            </DYMOPoint>\n' +
            '            <Size>\n' +
            '              <Width>1.19083</Width>\n' +
            '              <Height>0.2129497</Height>\n' +
            '            </Size>\n' +
            '          </ObjectLayout>\n' +
            '        </TextObject>\n' +
            '      </LabelObjects>\n' +
            '    </DynamicLayoutManager>\n' +
            '  </DYMOLabel>\n' +
            '  <LabelApplication>Blank</LabelApplication>\n' +
            '  <DataTable>\n' +
            '    <Columns></Columns>\n' +
            '    <Rows></Rows>\n' +
            '  </DataTable>\n' +
            '</DesktopLabel>';


        var printers = dymo.label.framework.getLabelWriterPrinters();

        if (printers.length === 0){
            alert(jsErrorPrinterNotFound);
            return false;
        } else {
            var printer = printers[0];
            var renderParamsXml = dymo.label.framework.createLabelWriterPrintParamsXml({copies:numberOfCopies});
            dymo.label.framework.printLabel(printer.name, renderParamsXml, labelXml, '');
        }
    }
}

function ObjectInfo(name, text)
{
    this.name = name;
    this.text = text;
}
